{% extends 'sidebar.html' %} {% block content %}
<div class="container-fluid">
  <h3 class="text-center" style="margin-bottom: 25px">Currency Converter</h3>
  <div class="d-flex justify-content-center align-items-center">
    <div class="w-75-m w-50-l">
      <form method="POST">
        {{ form.csrf_token }}
        <div class="form-group col-12 mx-auto" style="margin-bottom: 25px">
          <label for="amount" class="form-label">Amount </label>
          <input
            type="text"
            class="form-control"
            id="amount"
            name="amount"
            {%
            if
            form.amount.data
            %}
            value="{{ form.amount.data }}"
            {%
            endif
            %}
            required
          />
          {% if form.errors.get('amount') %}
          <div class="text-danger small">
            {{ form.errors.get('amount')[0] }}
          </div>
          {% endif %}
        </div>

        <div class="form-group col-12 mx-auto" style="margin-bottom: 25px">
          <label for="from_cur" class="form-label">From Currency </label>
          <select class="form-select" id="from_cur" name="from_cur">
            {% for currency in currencies %}
            {% if from_cur and from_cur==currency.code%}
                <option value="{{ currency.code }}" data-image="{{ url_for('static', filename='flags/' + currency.alpha_2_code.lower() + '.png') }}" selected>
                  {{ currency.code }} - {{ currency.name }}
                </option>
            {% else %}
              <option value="{{ currency.code }}" data-image="{{ url_for('static', filename='flags/' + currency.alpha_2_code.lower() + '.png') }}">
                {{ currency.code }} - {{ currency.name }}
              </option>
            {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="text-center" style="margin-bottom: 25px">
          <i class="fa-solid fa-arrow-right-arrow-left fa-rotate-90 fa-2xl cursor-pointer" id="exchange_icon" ></i>
        </div>

        <div class="form-group col-12 mx-auto" style="margin-bottom: 45px">
          <label for="to_cur" class="form-label">To Currency </label>
          <select class="form-select" id="to_cur" name="to_cur">
            {% for currency in currencies %}
            {% if to_cur and to_cur==currency.code%}
                <option value="{{ currency.code }}" data-image="{{ url_for('static', filename='flags/' + currency.alpha_2_code.lower() + '.png') }}" selected>
                  {{ currency.code }} - {{ currency.name }}
                </option>
            {% else %}
              <option value="{{ currency.code }}" data-image="{{ url_for('static', filename='flags/' + currency.alpha_2_code.lower() + '.png') }}">
                {{ currency.code }} - {{ currency.name }}
              </option>
            {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="d-grid col-3 mx-auto mb-3" style="margin-bottom: 45px">
          <button type="submit" class="btn btn-primary square">Convert</button>
        </div>
        {% if exchange_rate %}
        <div class="text-center" id="exchange_rate">
            Exchange Rate = <span style="font-weight:bold"> {{exchange_rate}} </span>
        </div>
        {% endif %}
        {% if form.amount.data and convert_result %}
        <div class="text-center" style="font-weight:bold; font-size:20px" id="result">
            {{form.amount.data}} {{form.from_cur.data.code}} = {{convert_result}} {{form.to_cur.data.code}}
        </div>
        {% endif %}
      </form>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    function formatOption(option) {
      if (!option.id) {
          return option.text;
      }

      var imageUrl = $(option.element).data('image');
      if (!imageUrl) {
        return option.text;
    }

      return $('<span><img src="' + imageUrl + '" class="img-flag" style="width:25px;height:15px;margin-right:5px"/> ' + option.text + '</span>');
    }

    $('#from_cur').select2({
      theme: 'bootstrap-5',
      templateResult: formatOption,
      templateSelection: formatOption,
      width: '100%',
    });

    $('#to_cur').select2({
      theme: 'bootstrap-5',
      templateResult: formatOption,
      templateSelection: formatOption,
      width: '100%',
    });

    $('#exchange_icon').click(function() {
      var from_cur = $('#from_cur').val();
      var to_cur = $('#to_cur').val();
  
      $('#from_cur').val(to_cur).trigger('change');
      $('#to_cur').val(from_cur).trigger('change');
    });

  });
</script>
{% endblock %}
